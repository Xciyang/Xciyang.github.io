<!DOCTYPE html>
<html>

<head><meta name="generator" content="Hexo 3.9.0">
  
  <title>技巧 - 写一个应用于Luogu的油猴插件 - Ciyang’s Blog</title>
  <meta charset="UTF-8">
  <meta name="description" content="一个半退役OI的文化课选手...">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  

  <link rel="shortcut icon" href="/favicon.png" type="image/png">
  <meta name="description" content="写一个应用于Luogu的油猴插件，拥有在任意页面上快捷搜索跳转题目的功能。 安装链接（插件发布地址）: https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher">
<meta name="keywords" content="技巧,颓废,JavaScript,HTML">
<meta property="og:type" content="article">
<meta property="og:title" content="技巧 - 写一个应用于Luogu的油猴插件">
<meta property="og:url" content="https://xciyang.github.io/2019-08/22-luogusearcher/index.html">
<meta property="og:site_name" content="Ciyang’s Blog">
<meta property="og:description" content="写一个应用于Luogu的油猴插件，拥有在任意页面上快捷搜索跳转题目的功能。 安装链接（插件发布地址）: https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-08-23T11:42:32.053Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="技巧 - 写一个应用于Luogu的油猴插件">
<meta name="twitter:description" content="写一个应用于Luogu的油猴插件，拥有在任意页面上快捷搜索跳转题目的功能。 安装链接（插件发布地址）: https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher">
  <script src="https://lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://lib.baomitu.com/mdui/0.4.3/css/mdui.min.css">
  <link rel="stylesheet" href="https://lib.baomitu.com/highlight.js/9.15.10/styles/hopscotch.min.css">
  
  <link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css">
  
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1361180_eqmr8hm9nwr.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1038733_0xvrvpg9c0r.css">
  <link rel="stylesheet" href="/css/style.css?v=1570452848921">
</head>

<body class="mdui-drawer-body-left">
  
  <div id="nexmoe-background">
    <div class="nexmoe-bg" style="background-image: url(/medias/banner/8.jpg)"></div>
    <div class="mdui-appbar mdui-shadow-0">
      <div class="mdui-toolbar">
        <a mdui-drawer="{target: '#drawer', swipe: true}" title="menu" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">menu</i></a>
        <div class="mdui-toolbar-spacer"></div>
        <!--<a href="javascript:;" class="mdui-btn mdui-btn-icon"><i class="mdui-icon material-icons">search</i></a>-->
        <a href="/" title="Ciyang" class="mdui-btn mdui-btn-icon"><img src="/medias/avatar.jpg"></a>
      </div>
    </div>
  </div>
  <div id="nexmoe-header">
    <div class="nexmoe-drawer mdui-drawer" id="drawer">
    <div class="nexmoe-avatar mdui-ripple">
        <a href="/" title="Ciyang">
            <img src="/medias/avatar.jpg" alt="Ciyang">
        </a>
    </div>
    <div class="nexmoe-count">
        <div><span>文章</span>29</div>
        <div><span>标签</span>38</div>
        <div><span>分类</span>4</div>
    </div>
    <ul class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}">
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/" title="首页">
            <i class="mdui-list-item-icon nexmoefont icon-home"></i>
            <div class="mdui-list-item-content">
                首页
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/about/" title="关于">
            <i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
            <div class="mdui-list-item-content">
                关于
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/friends/" title="友情链接">
            <i class="mdui-list-item-icon nexmoefont icon-unorderedlist"></i>
            <div class="mdui-list-item-content">
                友情链接
            </div>
        </a>
        
        <a class="nexmoe-list-item mdui-list-item mdui-ripple" href="/search" title="搜索">
            <i class="mdui-list-item-icon nexmoefont icon-search"></i>
            <div class="mdui-list-item-content">
                搜索
            </div>
        </a>
        
    </ul>
    <aside id="nexmoe-sidebar">
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">社交按钮</h3>
    <div class="nexmoe-widget nexmoe-social">
        <a class="mdui-ripple" href="https://github.com/Xciyang" target="_blank" mdui-tooltip="{content: 'GitHub'}" style="color: rgb(25, 23, 23);background-color: rgba(25, 23, 23, .15);">
            <i class="nexmoefont icon-github"></i>
        </a><a class="mdui-ripple" href="https://www.zhihu.com/people/ci-yang-ciyang" target="_blank" mdui-tooltip="{content: '知乎'}" style="color: rgb(123, 12, 57);background-color: rgba(123, 12, 57, .15);">
            <i class="nexmoefont icon-zhihu"></i>
        </a><a class="mdui-ripple" href="https://space.bilibili.com/6068536" target="_blank" mdui-tooltip="{content: '哔哩哔哩'}" style="color: rgb(231, 106, 141);background-color: rgba(231, 106, 141, .15);">
            <i class="nexmoefont icon-bilibili"></i>
        </a><a class="mdui-ripple" href="http://wpa.qq.com/msgrd?v=3&uin=896681584&site=qq&menu=yes" target="_blank" mdui-tooltip="{content: 'QQ'}" style="color: rgb(12, 2, 255);background-color: rgba(12, 2, 255, .15);">
            <i class="nexmoefont icon-QQ"></i>
        </a><a class="mdui-ripple" href="mailto:896681584@qq.com" target="_blank" mdui-tooltip="{content: '邮箱'}" style="color: rgb(123, 1, 255);background-color: rgba(123, 1, 255, .15);">
            <i class="nexmoefont icon-mail-fill"></i>
        </a><a class="mdui-ripple" href="/rss.xml" target="_blank" mdui-tooltip="{content: 'RSS'}" style="color: rgb(2, 10, 56);background-color: rgba(2, 10, 56, .15);">
            <i class="nexmoefont icon-rss"></i>
        </a>
    </div>
</div>
  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章分类</h3>
    <div class="nexmoe-widget">

      <ul class="category-list">

        


        

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/技巧/">技巧</a>
          <span class="category-list-count">2</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/闲聊/">闲聊</a>
          <span class="category-list-count">4</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/项目/">项目</a>
          <span class="category-list-count">3</span>
        </li>

        

        <li class="category-list-item">
          <a class="category-list-link" href="/categories/题解/">题解</a>
          <span class="category-list-count">20</span>
        </li>

        
      </ul>

    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">标签云</h3>
    <div id="randomtagcloud" class="nexmoe-widget tagcloud">
      <a href="/tags/Cpp/" style="font-size: 20px;">Cpp</a> <a href="/tags/GCD/" style="font-size: 10px;">GCD</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/JavaScript/" style="font-size: 10px;">JavaScript</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/STL/" style="font-size: 11.67px;">STL</a> <a href="/tags/ST表/" style="font-size: 10px;">ST表</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/二分查找/" style="font-size: 10px;">二分查找</a> <a href="/tags/分块/" style="font-size: 13.33px;">分块</a> <a href="/tags/前缀和/" style="font-size: 10px;">前缀和</a> <a href="/tags/动态规划/" style="font-size: 15px;">动态规划</a> <a href="/tags/块状链表/" style="font-size: 10px;">块状链表</a> <a href="/tags/字典树/" style="font-size: 10px;">字典树</a> <a href="/tags/字符串/" style="font-size: 10px;">字符串</a> <a href="/tags/左偏树/" style="font-size: 10px;">左偏树</a> <a href="/tags/并查集/" style="font-size: 11.67px;">并查集</a> <a href="/tags/技巧/" style="font-size: 11.67px;">技巧</a> <a href="/tags/搜索/" style="font-size: 16.67px;">搜索</a> <a href="/tags/数论/" style="font-size: 10px;">数论</a> <a href="/tags/整除分块/" style="font-size: 10px;">整除分块</a> <a href="/tags/模拟/" style="font-size: 13.33px;">模拟</a> <a href="/tags/比赛/" style="font-size: 10px;">比赛</a> <a href="/tags/爬虫/" style="font-size: 13.33px;">爬虫</a> <a href="/tags/状压DP/" style="font-size: 11.67px;">状压DP</a> <a href="/tags/码风/" style="font-size: 10px;">码风</a> <a href="/tags/离散化/" style="font-size: 10px;">离散化</a> <a href="/tags/线段树/" style="font-size: 10px;">线段树</a> <a href="/tags/背包/" style="font-size: 10px;">背包</a> <a href="/tags/莫比乌斯反演/" style="font-size: 10px;">莫比乌斯反演</a> <a href="/tags/莫队/" style="font-size: 10px;">莫队</a> <a href="/tags/语录/" style="font-size: 10px;">语录</a> <a href="/tags/边压Trie/" style="font-size: 10px;">边压Trie</a> <a href="/tags/闲聊/" style="font-size: 15px;">闲聊</a> <a href="/tags/随机化搜索/" style="font-size: 11.67px;">随机化搜索</a> <a href="/tags/项目/" style="font-size: 13.33px;">项目</a> <a href="/tags/颓废/" style="font-size: 15px;">颓废</a> <a href="/tags/题解/" style="font-size: 18.33px;">题解</a>
    </div>
    
  </div>

  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">文章归档</h3>
    <div class="nexmoe-widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li></ul>
    </div>
  </div>


  
  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">最新文章</h3>
    <div class="nexmoe-widget">
      <ul>
        
          <li>
            <a href="/2019-09/29-atbeginner142/">比赛 - AtCoder Beginner Contest 142</a>
          </li>
        
          <li>
            <a href="/2019-09/25-luogu1026/">NOIP2001 - 统计单词个数</a>
          </li>
        
          <li>
            <a href="/2019-09/20-luogu2540/">NOIP2015 - 斗地主增强版</a>
          </li>
        
          <li>
            <a href="/2019-09/19-luogu1282/">LuoguP1282 - 多米诺骨牌</a>
          </li>
        
          <li>
            <a href="/2019-09/02-luogu2522/">HAOI2011 - Problem b</a>
          </li>
        
      </ul>
    </div>
  </div>

  
  <div class="nexmoe-widget-wrap">
    <h3 class="nexmoe-widget-title">访客量</h3>
    <div class="nexmoe-widget" style="text-align: center;">
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">
            <style="text-align: center;">本站总访问量<span id="busuanzi_value_site_pv"></span>次
        </style="text-align:></span>
        <br>
        <span id="busuanzi_container_page_pv">
            本文总阅读量<span id="busuanzi_value_page_pv"></span>次
        </span>
    </div>
</div>
  
</aside>
    <div class="nexmoe-copyright">
        &copy; 2019 Ciyang
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
        & <a href="https://nexmoe.com/hexo-theme-nexmoe.html" target="_blank">Nexmoe</a>
    </div>
</div><!-- .nexmoe-drawer -->
  </div>
  <div id="nexmoe-content">
    <div class="nexmoe-primary">
      <div class="nexmoe-post">
  <div class="nexmoe-post-cover">
    
    <img id="coverback">
    <script>
      var nowImg = document.getElementById('coverback'), key = '190822';
      nowImg.src = '/medias/banner/' + key % Number("12") + '.jpg';
    </script>
    
    <h1>技巧 - 写一个应用于Luogu的油猴插件</h1>
  </div>
  <div class="nexmoe-post-meta">
    <a><i class="nexmoefont icon-calendar-fill"></i>2019年08月22日</a>
    <a><i class="nexmoefont icon-areachart"></i>2k 字</a>
    <a><i class="nexmoefont icon-time-circle-fill"></i>大概 9 分钟</a>
    
    <a class="nexmoefont icon-appstore-fill -link" href="/categories/技巧/">技巧</a>
    
    
    <a class="nexmoefont icon-tag-fill -link" href="/tags/HTML/">HTML</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/JavaScript/">JavaScript</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/技巧/">技巧</a> <a class="nexmoefont icon-tag-fill -link" href="/tags/颓废/">颓废</a>
    
  </div>
  <article id="article">
    <p>写一个应用于Luogu的油猴插件，拥有在任意页面上快捷搜索跳转题目的功能。</p>
<p>安装链接（插件发布地址）: <a href="https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher" target="_blank" rel="noopener">https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher</a></p>
<a id="more"></a>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>应同机房大佬要求，做一个洛谷快捷题目搜索的油猴插件。</p>
<h4 id="一些鲜为人知的历史"><a href="#一些鲜为人知的历史" class="headerlink" title="一些鲜为人知的历史"></a>一些鲜为人知的历史</h4><p>其实这个早在洛谷??.9版本（大概是18年底的一次UI更新）就写过一次了。</p>
<p>那段时间luogu把搜索框去掉了，以致于不能方便的搜索题目，才写了这个插件，并且使用luogu很早前搜索框的css。</p>
<p>过了半个月洛谷又更新了，然后右上角个人头像旁边多了搜索框。我当时直接退坑了，后来没多长时间插件就无法使用了。</p>
<h4 id="为什么要重构插件"><a href="#为什么要重构插件" class="headerlink" title="为什么要重构插件"></a>为什么要重构插件</h4><p>然后我发现洛谷新的搜索框非常不贴近人意（小声），然后同机房大佬又一次要求。</p>
<p>趁着没东西颓废一晚上颓了出来，恰好半年时间，我的JS、HTML能力已经大幅提高，所以这个插件做起来相当简单。</p>
<h4 id="那现在和半年前有什么区别"><a href="#那现在和半年前有什么区别" class="headerlink" title="那现在和半年前有什么区别"></a>那现在和半年前有什么区别</h4><p>首先洛谷把半年前已经废了的CSS都删了（包括半年前的搜索框CSS）。</p>
<p>并且洛谷的页面也有很大变化。误人子弟的说一句，好像洛谷现在是二次加载动态渲染？然后不用jQuery了？</p>
<p>然后是个人原因，现在的我有一定JS写代码能力，对一些基础语法比较熟练，熟悉很多方法。之前傻傻分不清jQuery和Web API的函数，只能一次一次测试来运用（哪个能用就用哪个）。</p>
<h3 id="正题"><a href="#正题" class="headerlink" title="正题"></a>正题</h3><p>可以先进入文章开头的链接查看介绍，也可以查看全部代码。</p>
<p>首先我们设定 F1 打开搜索框，若已打开就关闭，F1键码为112。注册按键：</p>
<pre><code class="lang-js">document.onkeydown = function (event) { if (event.keyCode == 112) mainfunc(); };
</code></pre>
<p>mainfunc 函数就是用来打开关闭对话框。但是这个页面本来没有对话框，该怎么打开呢？</p>
<p>那么就需要新建，新建需要在网页中插入HTML。根据经验，我们需要在页面加载完成之后才能插入HTML，否则有不可预料的BUG。判断网页是否加载完成：</p>
<pre><code class="lang-js">if (document.readyState == &quot;complete&quot;) {
    /*
    Write your code here.
    */
}
</code></pre>
<p>然后就是新建元素、改样式、插入到网页中，这些很语法基础就直接给出，相关函数请自行了解。</p>
<p>我们选择把元素加入到页面的app（洛谷设计的）中。初始化：</p>
<pre><code class="lang-js">var newElement = document.createElement(&quot;div&quot;);
newElement.id = &quot;CiyangSearch&quot;;
newElement.innerHTML = &quot;&lt;input type = &#39;text&#39;&gt; | &lt;a&gt;&lt;i class = &#39;fas fa-search&#39;&gt;&lt;/i&gt;&lt;/a&gt; | &lt;a&gt;&lt;i class= &#39;fa fa-cog&#39;&gt;&lt;/i&gt;&lt;/a&gt;&quot;;
newElement.style.position = &quot;fixed&quot;;
newElement.style.zIndex = &quot;2&quot;;
newElement.style.top = &quot;10%&quot;;
newElement.style.left = &quot;30%&quot;;
newElement.style.width = &quot;240px&quot;;
newElement.style.backgroundColor = &quot;rgb(128,128,128)&quot;;
var appElement = document.getElementById(&#39;app&#39;);
appElement.appendChild(newElement);
</code></pre>
<p>上面的代码就已经可以打开一个搜索框，还有搜索按钮和设置按钮，但非常丑陋。</p>
<p>只有搜索框但是不能进行搜索，所以要绑定点击搜索按钮和回车键，回车键的键码为13。注册函数：</p>
<pre><code class="lang-js">newElement.children[0].onkeydown = function (event) {
    if (event.keyCode == 13) {
        var str = this.value;
        /*
        Write your code here.
        */
    }
    return;
};
newElement.children[1].onclick = function () {
    var str = newElement.children[0].value;
    /*
    Write your code here.
    */
    return;
};
</code></pre>
<p>str就是搜索框中输入的内容，获取后就可以跳转题目了。</p>
<p>我们想让它可自动识别是否为题目，如果是就打开题目页面，否则就打开题目列表进行搜索。</p>
<p>比如：输入P1001打开P1001题目页面，输入1001就进入题目列表搜索1001。</p>
<p>因为OI不学正则表达式，所以一般情况下我们想到if判断。这非常麻烦，会使代码复杂冗长，这个时候正则表达式就能大显身手了。</p>
<p>此处借鉴了另一个油猴插件<a href="https://greasyfork.org/zh-CN/scripts/388947-luogu-problem-jumper" target="_blank" rel="noopener">Luogu Problem Jumper</a>的匹配代码，应该是匹配洛谷题目最好的代码。</p>
<pre><code class="lang-js">function judegeProblem(str) {
    if (str.match(/AT[0-9]{1,4}/) == str) return true;
    if (str.match(/CF[0-9]{1,4}[A-Z][0-9]{0,1}/) == str) return true;
    if (str.match(/SP[0-9]{1,5}/) == str) return true;
    if (str.match(/P[0-9]{4}/) == str) return true;
    if (str.match(/UVA[0-9]{1,5}/) == str) return true;
    if (str.match(/U[0-9]{1,6}/) == str) return true;
    if (str.match(/T[0-9]{1,6}/) == str) return true;
    return false;
}
</code></pre>
<p>接下来是打开页面，有两种方式，前者是从当前页跳转，后者是新标签页打开。</p>
<pre><code class="lang-js">window.location = url;
window.open(url);
</code></pre>
<p>我们想要设计为用户选择首选方式，可首选其中一种方式，搜索时先输入 # 才能用优先级低的方式。</p>
<pre><code class="lang-js">var dUrl = 1;
/*

A lot of code.

*/
function judgeURL(way, str) {
    if (str.length == 0) return;
    if (judegeProblem(str)) go(dUrl ^ way, &#39;/problemnew/show/&#39; + str);
    else go(dUrl ^ way, &#39;/problem/list?keyword=&#39; + str);
    return;
}
function go(k, url) {
    if (k == 0) window.location = url;
    else window.open(url);
    removek();
}
</code></pre>
<p>dUrl设为1就是首选新标签页，way表示是否先输入了 # 。</p>
<p>再回到绑定按键、点击搜索按钮的地方，比较懒所以代码没有合并到一起：</p>
<pre><code class="lang-js">newElement.children[0].onkeydown = function (event) {
    if (event.keyCode == 13) {
        var str = this.value;
        if (str.length == 0) return;
        if (str[0] == &#39;#&#39;) judgeURL(1, str.substring(1, str.length));
        else judgeURL(0, str);
    }
    return;
};
newElement.children[1].onclick = function () {
    var str = newElement.children[0].value;
    if (str.length == 0) return;
    if (str[0] == &#39;#&#39;) judgeURL(1, str.substring(1, str.length));
    else judgeURL(0, str);
    return;
};
</code></pre>
<p>主体基本完成，然后就是一些小功能。若打开搜索框，再次按下 F1 关闭。使设置打开页面方式更加可视化，完善设置按钮。</p>
<p>在 mainfuc 函数中，先加入一行代码：</p>
<pre><code class="lang-js">if (removek()) return;
</code></pre>
<p>之前我们为了方便，将搜索框整体的元素ID改为了CiyangSearch，可以直接根据此ID来获取控件。代码简单：</p>
<pre><code class="lang-js">function removek() {
    var search = document.getElementById(&quot;CiyangSearch&quot;);
    if (search) {
        search.parentNode.removeChild(search);
        return true;
    }
    return false;
}
</code></pre>
<p>完善设置按钮也很简单，首先在 mainfunc 绑定按键、搜索按钮处理下加入一行代码：</p>
<pre><code class="lang-js">newElement.children[2].onclick = function () { setLink(); };
</code></pre>
<p>先介绍两个油猴自带的函数，GM_setValue和GM_getValue，可以非常方便的存储和读取数据，具体原理可以自行搜索。</p>
<p>点击设置按钮后跳出对话框，用户输入1或者0，设置首选方式。将之前的dUrl设置为读取数据。</p>
<pre><code class="lang-js">var dUrl = GM_getValue(&quot;default_way&quot;);
function setLink() {
    var defaultWay = prompt(&quot;请输入首选打开网页方式，1 为新标签页，0为从当前页跳转。当前为&quot; + dUrl + &quot;，搜索先输入 # 可使用优先级低的方式。&quot;);
    if (defaultWay == null) return;
    if (defaultWay != &quot;0&quot; &amp;&amp; defaultWay != &quot;1&quot;) {
        alert(&quot;您的输入有误&quot;);
        return;
    }
    GM_setValue(&quot;default_way&quot;, defaultWay);
    location.reload();
}
</code></pre>
<p>我们还有需要一个使搜索的输入框自动获得焦点的小特性，只要在元素（控件）插入页面后加入一行代码：</p>
<pre><code class="lang-js">newElement.children[0].focus();
</code></pre>
<p>然后8.23美化了一下UI，具体就不给出了。增加了设置背景颜色，换汤不换药。其中较为重要的修改：</p>
<pre><code class="lang-js">var dUrl = GM_getValue(&quot;default_way&quot;), bgColor = GM_getValue(&quot;searcher_bg&quot;);
if (bgColor == undefined) {
    GM_setValue(&quot;searcher_bg&quot;, &quot;rgba(135,206,235,0.5)&quot;);
    bgColor = &quot;rgba(135,206,235,0.5)&quot;;
}
newElement.innerHTML = &quot;&lt;input type = &#39;text&#39;&gt; | &lt;i class = &#39;fas fa-search&#39;&gt;&lt;/i&gt; | &lt;i class= &#39;fas fa-cog&#39;&gt;&lt;/i&gt; | &lt;i class =&#39;fas fa-crosshairs&#39;&gt;&lt;/i&gt; |&quot;;
function setBGColor() {
    var searcherBG = prompt(&quot;请输入背景颜色码，支持RGB和十六进制。当前为&quot; + bgColor + &quot;。&quot;, bgColor);
    if (searcherBG == null) return;
    GM_setValue(&quot;searcher_bg&quot;, searcherBG);
    location.reload();
}
</code></pre>
<p>分别处于代码各个位置，思路与设置打开方式类似，自行了解即可。</p>
<h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>还有什么问题可以在博客或发布网站评论提出，也可以用社交软件联系我。</p>
<p>在greasyfork发布，链接：<a href="https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher" target="_blank" rel="noopener">https://greasyfork.org/zh-CN/scripts/389291-luogu-quick-searcher</a></p>
<p>如果时间充足还会一直更新，有要求也可以提出。</p>

  </article>
  
  
<div class="nexmoe-post-copyright">
<i class="mdui-list-item-icon nexmoefont icon-info-circle"></i>
<strong>本文作者：</strong>Ciyang<br>
<strong>本文链接：</strong><a href="https://xciyang.github.io/2019-08/22-luogusearcher/" title="https://xciyang.github.io/2019-08/22-luogusearcher/" target="_blank" rel="noopener">https://xciyang.github.io/2019-08/22-luogusearcher/</a><br>

  <strong>版权声明：</strong>本文一切由权利由作者 Ciyang 所有，转载请声明本文地址。

</div>


  
  <section class="nexmoe-comment">
    <div id="lv-container" data-id="city" data-uid="MTAyMC80NjA4Ni8yMjU5Nw==">
    <script id="livere-comment-js">
    (function(d, s) {
       var j, e = d.getElementsByTagName(s)[0];
       if (typeof LivereTower === 'function') { return; }
       j = d.createElement(s);
       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
       j.async = true;
       e.parentNode.insertBefore(j, e);
    })(document, 'script');
    </script>
</div>
</section>
</div>

    </div>
  </div>
  <script src="https://lib.baomitu.com/mdui/0.4.3/js/mdui.min.js"></script>
 
    <script src="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js"></script>


 
    <script src="https://lib.baomitu.com/smoothscroll/1.4.10/SmoothScroll.min.js"></script>


<script src="https://lib.baomitu.com/highlight.js/9.15.10/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="/js/app.js?v=1570452848933"></script>
<script src="https://lib.baomitu.com/lazysizes/5.1.1/lazysizes.min.js"></script>


    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/xtaodada/xtaodada.github.io@0.0.2/copy.js"></script>


  



    <!-- Tencent Analytics -->
<script>
    (function() {
        var hm = document.createElement("script");
        hm.src = "//tajs.qq.com/stats?sId=66465453";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


    <!-- 51.La Analytics -->
<div hidden>
  <script type="text/javascript" src="https://js.users.51.la/20284321.js"></script>
</div>


    <!-- baidu Analytics -->
<script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?c285bfd3ab71dfa2d08b9656991e938e';
    var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>

</body>

</html>